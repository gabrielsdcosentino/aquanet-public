{% extends 'base.html' %}

{% block title %}Notificações - AquaNet{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto pb-20">
    <div class="bg-white p-4 rounded-3xl shadow-sm border border-slate-100 mb-6 flex justify-between items-center sticky top-20 z-10">
        <h1 class="text-xl font-bold text-slate-800">Notificações</h1>
        </div>

    <div class="space-y-3">
        {% for n in notifications %}
        
        {% if n.action == 'badge' %}
        <a href="{{ url_for('profile', username=current_user.username) }}" class="block bg-gradient-to-r from-yellow-50 to-white p-4 rounded-3xl shadow-sm border border-yellow-200 hover:shadow-md transition-all relative overflow-hidden group">
            <div class="absolute top-0 right-0 w-16 h-16 bg-yellow-400 opacity-10 rounded-bl-full -mr-4 -mt-4"></div>
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center text-xl shadow-sm shrink-0 border border-yellow-200">
                    <i class="fas fa-trophy"></i>
                </div>
                <div>
                    <p class="text-sm text-slate-800">
                        <span class="font-bold text-yellow-700">Parabéns!</span> Você desbloqueou uma nova conquista.
                    </p>
                    <p class="text-xs text-slate-500 mt-0.5 font-medium">Toque para ver na sua Sala de Troféus.</p>
                    <p class="text-[10px] text-slate-400 mt-2">{{ n.timestamp.strftime('%d/%m às %H:%M') }}</p>
                </div>
            </div>
        </a>

        {% else %}
        <a href="{{ url_for('post_detail', post_id=n.post_id) if n.post_id else url_for('profile', username=n.sender.username) }}" class="block p-4 rounded-3xl shadow-sm border transition-all {{ 'bg-white border-slate-100 opacity-75' if n.is_read else 'bg-blue-50/50 border-blue-100' }}">
            <div class="flex items-start gap-3">
                <img src="{{ n.sender.profile_pic_url }}" class="w-10 h-10 rounded-full object-cover border border-slate-100 shrink-0">
                
                <div class="flex-grow">
                    <p class="text-sm text-slate-800 leading-snug">
                        <span class="font-bold">{{ n.sender.username }}</span>
                        
                        {% if n.action == 'mention' %} marcou você em uma publicação.
                        {% elif n.action == 'comment' %} comentou na sua publicação.
                        {% elif n.action == 'reply' %} respondeu seu comentário.
                        {% elif n.action == 'follow' %} começou a seguir você.
                        {% elif n.action == 'like_post' %} curtiu sua publicação.
                        {% elif n.action == 'like_comment' %} curtiu seu comentário.
                        {% endif %}
                        
                        {% if n.count > 1 %}
                        <span class="bg-red-100 text-red-600 text-[10px] font-bold px-1.5 py-0.5 rounded-full ml-1">+{{ n.count - 1 }}</span>
                        {% endif %}
                    </p>

                    {% if n.action in ['comment', 'reply', 'mention'] %}
                        <div class="mt-2 text-xs text-slate-500 bg-slate-50 p-2 rounded-xl border border-slate-100 italic truncate max-w-[250px]">
                            "{% if n.comment_id and n.comment %}{{ n.comment.text }}{% elif n.post_id and n.post %}{{ n.post.content }}{% endif %}"
                        </div>
                    {% endif %}
                    
                    <p class="text-[10px] text-slate-400 mt-2 font-medium">{{ n.timestamp.strftime('%d/%m às %H:%M') }}</p>
                </div>

                <div class="text-lg text-slate-300">
                    {% if n.action == 'like_post' or n.action == 'like_comment' %}<i class="fas fa-thumbs-up text-blue-400"></i>
                    {% elif n.action == 'comment' or n.action == 'reply' %}<i class="fas fa-comment text-blue-400"></i>
                    {% elif n.action == 'follow' %}<i class="fas fa-user-plus text-green-400"></i>
                    {% elif n.action == 'mention' %}<i class="fas fa-at text-purple-400"></i>
                    {% endif %}
                </div>
            </div>
        </a>
        {% endif %}

        {% else %}
        <div class="text-center py-12">
            <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300 text-2xl">
                <i class="far fa-bell-slash"></i>
            </div>
            <p class="text-slate-500 font-medium text-sm">Nenhuma notificação nova.</p>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Encontra a bolinha vermelha no menu (se existir) e remove
        const badges = document.querySelectorAll('.fa-bell + span');
        badges.forEach(b => b.style.display = 'none');
    });
</script>
{% endblock %}