{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 mt-4 max-w-2xl">
    
    <div class="mb-6 pb-2 border-b border-gray-200">
        <h2 class="text-3xl font-black text-gray-800 tracking-tight">
            <i class="fas fa-bell text-yellow-500 mr-2"></i> Suas Notificações
        </h2>
        <p class="text-gray-500 text-sm mt-1">Veja as últimas interações no seu AquaNet.</p>
    </div>

    <div class="bg-white rounded-3xl shadow-xl border border-gray-100 overflow-hidden divide-y divide-gray-100">
        
        {% for n in notifications %}
            {% set target_url = url_for('profile', username=n.sender.username) if n.action == 'follow' else (url_for('post_detail', post_id=n.post_id) if n.post_id else '#') %}
            
            <a href="{{ target_url }}" 
               class="flex items-center p-4 sm:p-5 hover:bg-gray-50 transition-all group">
                
                <div class="w-10 h-10 rounded-full flex items-center justify-center mr-4 flex-shrink-0
                            {% if n.action == 'like_post' or n.action == 'like_comment' %} bg-red-100 text-red-600 
                            {% elif n.action == 'comment' or n.action == 'reply' %} bg-blue-100 text-blue-600 
                            {% elif n.action == 'follow' %} bg-green-100 text-green-600 
                            {% else %} bg-gray-100 text-gray-500 {% endif %}">
                    {% if n.action == 'like_post' or n.action == 'like_comment' %} <i class="fas fa-heart"></i>
                    {% elif n.action == 'comment' or n.action == 'reply' %} <i class="fas fa-comment"></i>
                    {% elif n.action == 'follow' %} <i class="fas fa-user-plus"></i>
                    {% else %} <i class="fas fa-info"></i>
                    {% endif %}
                </div>

                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-800 leading-snug">
                        <strong>@{{ n.sender.username }}</strong>
                        
                        {% if n.count > 1 %}
                            e mais {{ n.count - 1 }} pessoa(s)
                        {% endif %}

                        {% if n.action == 'like_post' %} 
                            curtiu seu post.
                        {% elif n.action == 'like_comment' %} 
                            curtiu seu comentário.
                        {% elif n.action == 'comment' %} 
                            comentou no seu post.
                        {% elif n.action == 'follow' %} 
                            começou a te seguir.
                        {% elif n.action == 'reply' %} 
                            respondeu seu comentário.
                        {% endif %}
                    </p>
                    
                    {% if n.post_id and n.action != 'follow' %}
                    <p class="text-xs text-gray-400 mt-1">
                        Toque para ver a conversa.
                    </p>
                    {% endif %}
                    
                    {% if n.action == 'follow' %}
                    <p class="text-xs text-gray-400 mt-1">
                        Perfil: Toque para seguir de volta.
                    </p>
                    {% endif %}
                </div>
                
                <div class="flex flex-col items-end flex-shrink-0 ml-4">
                    <small class="text-xs text-gray-400 mb-1">{{ n.timestamp.strftime('%d/%m %H:%M') }}</small>
                    <i class="fas fa-chevron-right text-xs text-gray-300 group-hover:text-blue-500"></i>
                </div>
                
            </a>
        {% else %}
            <div class="p-12 text-center text-gray-500">
                <div class="w-12 h-12 bg-gray-100 text-gray-400 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-inbox text-xl"></i>
                </div>
                <h4 class="font-bold">Sua caixa de entrada está vazia!</h4>
                <p class="text-sm mt-1">Você não tem novas notificações.</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
