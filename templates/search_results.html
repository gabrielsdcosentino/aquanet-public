{% extends 'base.html' %}

{% block title %}Busca: {{ query }} - AquaNet{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto pb-10">
    <div class="bg-white p-4 rounded-3xl shadow-sm border border-slate-100 mb-6">
        <h1 class="text-xl font-bold text-slate-800 flex items-center gap-2">
            <i class="fas fa-search text-blue-600"></i>
            Resultados para "{{ query }}"
        </h1>
    </div>

    {% if communities_results %}
    <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-100 mb-6">
        <h2 class="font-bold text-lg text-slate-700 mb-4 pb-2 border-b border-slate-100">Comunidades</h2>
        <ul class="space-y-3">
            {% for community in communities_results %}
            <li>
                <a href="{{ url_for('community_feed', community_slug=community.slug) }}" class="flex items-center group">
                    <div class="w-10 h-10 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center font-bold mr-3 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                        {{ community.name[:2].upper() }}
                    </div>
                    <div>
                        <span class="font-bold text-slate-800 group-hover:text-blue-600 transition-colors block">{{ community.name }}</span>
                        <span class="text-xs text-slate-500">{{ community.description or 'Sem descrição' }}</span>
                    </div>
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if encyclopedia_results %}
    <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-100 mb-6">
        <h2 class="font-bold text-lg text-slate-700 mb-4 pb-2 border-b border-slate-100">Enciclopédia</h2>
        <ul class="space-y-3">
            {% for entry in encyclopedia_results %}
            <li>
                <a href="{{ url_for('view_entry', slug=entry.slug) }}" class="flex items-center group">
                    {% if entry.image_file %}
                    <img src="{{ entry.image_file }}" class="w-10 h-10 rounded-lg object-cover mr-3 border border-slate-100">
                    {% else %}
                    <div class="w-10 h-10 rounded-lg bg-green-100 text-green-600 flex items-center justify-center mr-3">
                        <i class="fas fa-leaf"></i>
                    </div>
                    {% endif %}
                    <span class="font-bold text-slate-800 group-hover:text-green-600 transition-colors">{{ entry.title }}</span>
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if posts_results %}
    <div class="space-y-6 mb-8">
        <h2 class="font-bold text-lg text-slate-700 px-2">Publicações</h2>
        {% for post in posts_results %}
        <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-100">
            <div class="flex items-center mb-3">
                <img src="{{ post.author.profile_pic_url }}" class="w-10 h-10 rounded-full border border-gray-100 mr-3 object-cover">
                <div class="flex-grow">
                    <span class="font-bold text-sm text-gray-900 block">{{ post.author.username }}</span>
                    <span class="text-xs text-gray-500">{{ post.timestamp.strftime('%d/%m/%Y') }} em <a href="{{ url_for('community_feed', community_slug=post.community.slug) }}" class="font-bold text-blue-600 hover:underline">{{ post.community.name }}</a></span>
                </div>
            </div>
            
            <a href="{{ url_for('post_detail', post_id=post.id) }}" class="block">
                <p class="text-gray-800 mb-3 whitespace-pre-wrap">{{ post.content | truncate(200) }}</p>
                {% if post.image_file %}
                <img src="{{ post.image_file }}" class="w-full h-48 object-cover rounded-xl mb-3 border border-slate-100">
                {% endif %}
            </a>
            <div class="flex items-center gap-4 text-xs font-bold text-slate-400 mt-3 border-t border-slate-50 pt-3">
                <span><i class="fas fa-thumbs-up mr-1"></i> {{ post.likes|length }}</span>
                <span><i class="fas fa-comment mr-1"></i> {{ post.comments|length }}</span>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if comments_results %}
    <div class="space-y-4">
        <h2 class="font-bold text-lg text-slate-700 px-2">Comentários</h2>
        {% for comment in comments_results %}
        <div class="bg-white p-4 rounded-3xl shadow-sm border border-slate-100 hover:border-blue-200 transition-colors">
            <a href="{{ url_for('post_detail', post_id=comment.parent_post.id) }}#comment-{{ comment.id }}" class="block">
                <div class="flex items-center gap-2 mb-2">
                    <img src="{{ comment.comment_author.profile_pic_url }}" class="w-6 h-6 rounded-full object-cover">
                    <span class="text-xs font-bold text-slate-700">{{ comment.comment_author.username }}</span>
                    <span class="text-xs text-slate-400">comentou em um post</span>
                </div>
                <p class="text-slate-600 text-sm italic">"{{ comment.text | truncate(100) }}"</p>
            </a>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if not communities_results and not encyclopedia_results and not posts_results and not comments_results %}
    <div class="text-center py-10">
        <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-400 text-3xl">
            <i class="fas fa-search"></i>
        </div>
        <h3 class="font-bold text-slate-700 text-lg">Nenhum resultado</h3>
        <p class="text-slate-500">Tente buscar por outros termos.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
